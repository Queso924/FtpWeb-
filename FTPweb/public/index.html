
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Subir Archivo Temporal</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.2);
      width: 400px;
      animation: fadeIn 1s ease-in-out;
    }
    h1 {
      margin-bottom: 20px;
    }
    .file-label {
      background: #ff7eb3;
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      display: inline-block;
      font-size: 16px;
      transition: all 0.3s;
    }
    .file-label:hover {
      background: #ff558a;
      transform: scale(1.05);
    }
    .file-input {
      display: none;
    }
    .expiration-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .time-button {
      padding: 10px 15px;
      border: none;
      background: #007BFF;
      color: white;
      font-size: 14px;
      cursor: pointer;
      border-radius: 5px;
      transition: 0.3s;
    }
    .time-button:hover, .time-button.selected {
      background: #0056b3;
      transform: scale(1.05);
    }
    .progress-container {
      display: none;
      margin-top: 15px;
    }
    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress-bar-inner {
      height: 100%;
      width: 0%;
      background-color: #28a745;
      transition: width 0.3s;
    }
    .status-text {
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    .upload-button {
      margin-top: 20px;
      padding: 12px 20px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease-in-out;
      display: inline-block;
    }
    .upload-button:hover {
      background: #27ae60;
      transform: scale(1.05);
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÇ Subir Archivo Temporal</h1>
    <form id="uploadForm">
      <label for="archivo" class="file-label">üìÅ Seleccionar archivo</label>
      <br><br>
      <input type="file" name="archivo" id="archivo" class="file-input" required>
      <span id="file-name">No se ha seleccionado ning√∫n archivo</span>
      <br><br>

      <label>‚è≥ Tiempo de Caducidad:</label>
      <div class="expiration-buttons">
        <button type="button" class="time-button" data-time="1">1 min</button>
        <button type="button" class="time-button" data-time="5">5 min</button>
        <button type="button" class="time-button" data-time="10">10 min</button>
        <button type="button" class="time-button" data-time="15">15 min</button>
        <button type="button" class="time-button" data-time="20">20 min</button>
      </div>
      <input type="hidden" name="expiration" id="expiration" value="5">

      <br><br>
      <button type="button" id="uploadButton" class="upload-button">‚¨ÜÔ∏è Subir Archivo ‚¨ÜÔ∏è</button>

      <!-- Barra de progreso -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-bar-inner" id="progressBar"></div>
        </div>
        <p class="status-text" id="statusText">Subiendo...</p>
      </div>
    </form>
  </div>

  <script>
    document.getElementById("archivo").addEventListener("change", function() {
      let fileName = this.files[0] ? this.files[0].name : "No se ha seleccionado ning√∫n archivo";
      document.getElementById("file-name").textContent = fileName;
    });

    const timeButtons = document.querySelectorAll(".time-button");
    const expirationInput = document.getElementById("expiration");

    timeButtons.forEach(button => {
      button.addEventListener("click", () => {
        timeButtons.forEach(btn => btn.classList.remove("selected"));
        button.classList.add("selected");
        expirationInput.value = button.getAttribute("data-time");
      });
    });

    // Selecciona por defecto el de 5 minutos
    document.querySelector(".time-button[data-time='5']").classList.add("selected");

    


  document.getElementById("uploadButton").addEventListener("click", function() {
    let fileInput = document.getElementById("archivo");
    let expiration = document.getElementById("expiration").value;
    let progressBar = document.getElementById("progressBar");
    let statusText = document.getElementById("statusText");
    let progressContainer = document.querySelector(".progress-container");

    if (!fileInput.files.length) {
      alert("Selecciona un archivo antes de subirlo.");
      return;
    }

    let file = fileInput.files[0];
    let formData = new FormData();
    formData.append("archivo", file);
    formData.append("expiration", expiration);

    let xhr = new XMLHttpRequest();
    xhr.open("POST", "/upload", true);

    // Mostrar la barra de progreso
    progressContainer.style.display = "block";
    statusText.style.display = "block";

    xhr.upload.onprogress = function(event) {
      if (event.lengthComputable) {
        let percentComplete = (event.loaded / event.total) * 100;
        progressBar.style.width = percentComplete + "%";
        statusText.textContent = "Subiendo... " + Math.round(percentComplete) + "%";
      }
    };

    xhr.onload = function() {
  try {
    let response = JSON.parse(xhr.responseText); // ‚úÖ Asegurar que parseamos JSON correctamente

    if (xhr.status === 200 && response.success) {
      let safeFileName = response.file;  // ‚úÖ Usar el nombre correcto del archivo
      statusText.textContent = "‚úÖ Subida completa!";

      setTimeout(() => {
        window.location.href = "/success.html?file=" + encodeURIComponent(safeFileName) + "&time=" + response.expiration;
      }, 500);
    } else {
      console.error("‚ö†Ô∏è Error en la subida:", response.error);
      statusText.textContent = "‚ùå Error en la subida: " + response.error;
    }
  } catch (error) {
    console.error("‚ö†Ô∏è Error en la respuesta del servidor:", xhr.responseText);
    statusText.textContent = "‚ùå Error en la respuesta del servidor.";
  }
};


    xhr.onerror = function() {
      statusText.textContent = "‚ùå Error de conexi√≥n";
    };

    xhr.send(formData);
  });
</script>

  
</body>
</html>
